<!DOCTYPE html>
<html lang="en">
<html>
    <head>
        <title>Toronto's Environmentally Significant Areas - Open Toronto API</title>
        <meta http-equiv="Content-Type" content="text/html" charset="utf-8">

        <!-- STYLESHEETS -->
        <!-- Bootstrap (before stylesheets) -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
              integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <!-- MapBoxGL -->
        <script src='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
        <!-- MapBoxGL stylesheet-->
        <link href='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet' />
        <!-- <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.3/mapbox.css' rel='stylesheet' /> -->
        <!-- <script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.3/mapbox.js'></script> -->
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <style>
            body { margin:0; padding:0; }
            #map { width: 100%; height: 700px; }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script>
            // OLDSCHOOL:
            //L.mapbox.accessToken = '{{ACCESS_KEY}}';
            //var map = L.mapbox.map('map', 'mapbox.streets', {
            //  scrollWheelZoom: false,
            //  zoomControl: false
            //}).setView([65.0,-18.73], 7);

            // NEWSCHOOL:
            // Access token for MapBox
            mapboxgl.accessToken = '{{ ACCESS_KEY }}';

            // Create a new MapBoxGL map object
            var map = new mapboxgl.Map({
                container: 'map', // container id
                style: 'mapbox://styles/mapbox/light-v10', // stylesheet location
                //center: [-114.06667, 51.04999], // Calgary
                //center: [-18.73, 65.0], // Iceland
                center: [-79.383, 43.653], // Toronto
                zoom: 7 // starting zoom
            });
            // OLDSCHOOL: 
            // L.mapbox.featureLayer({{ route_data|safe }}).addTo(map);

            // NEWSCHOOL:
            // Create layer of coordinates (GeoJSON FeatureCollections) and load onto map
            map.on('load', function() {

                // Add source
                map.addSource('tripRoute', {
                    type: 'geojson',
                    data:  "https://ckan0.cf.opendata.inter.prod-toronto.ca/api/3/action/datastore_search?resource_id=ef5a083a-5c2a-4207-9131-dfc917917069"
                    //data: "https://data.calgary.ca/resource/fd9t-tdn2.geojson"
                });

                map.addLayer({
                    id: 'tripRoute',
                    type: 'symbol',
                    source: 'tripRoute',
                    layout: {
                        'icon-image': 'school-15',
                        'icon-size': 1.5
                    }
                });

            });
            // map.addSource('tripRoute', {
            //     type: 'geojson',
            //     data: '{{ route_data }}'
            // });
            // map.addLayer({
            //     id: 'tripRoute',
            //     source: 'tripRoute',
            //     type: 'symbol',
            //     layout: {
            //         'icon-image': 'dot',
            //         'icon-size': 0.25
            //      }
            // });
            //map.getSource('tripRoute').setData('{{ route_data }}');

        </script>
    </body>
</html>